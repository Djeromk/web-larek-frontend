# Проектная работа "Веб-ларек" выполнена по архитектуре MVP.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

#Бизнес-логика проекта

## 1 Управление каталогом товаров

•	Отображение списка товаров.
•	Показ детальной информации о каждом товаре по клику в модальном окне.

## 2 Корзина

•	Отображение корзины с выбранными позициями.
•	Добавление товара в корзину.
•	Удаление позиции из корзины.
•	Подсчет общей суммы заказа.

## 3 Оформление заказа

•	Выбор метода оплаты (наличные или карта).
•	Ввод адреса для доставки.
•	Ввод контактной информации.
•	Проверка на наличие введённых данных.
•	Создание и отправка заказа.
•	Показ сообщения об успешной оплате.

# Архитектура MVP проекта

## Взаимодействие компонентов
1. Пользователь взаимодействует с View
2. View генерирует события, которые обрабатывает Presenter
3. Presenter обновляет Model
4. Model генерирует события об изменении данных
5. Presenter обрабатывает эти события и обновляет View

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Модель данных
#### Интерфейсы
•	```IProduct``` - Для описания данных товара:

>`interface IProduct {`
	`id: string;  `
	`description: string;  `
	`image: string;  `
	`title: string;  `
	`category: string;  `
	`price: number | null;  `
`}`

•	```IOrder``` - Для описания данных заказа:

>`interface IOrder {`
	`paymentMethod: 'cash' | 'online';`
	`email: string;`
	`phone: string;`
	`address: string;`
	`totalAmount: number | string;`
	`items: IProduct[];`
`}`

•	```ICart``` - Для описания методов управления корзиной

> `interface ICart {`
	`cartItems: IProduct[];`
	`addItem(product: IProduct): void;`
	`removeItem(productId: string): void;`
	`getItems(): IProduct[];`
	`getTotalAmount(): number;`
	`clearCart(): void;`
`}`

- IAppState - Для описания состояния приложения

> `interface IAppState {`
	`catalog: IProduct[];`
	`cart: ICart;`
	`preview: IProduct | null;`
	`order: Partial<IOrder>;`
	`setCatalog(items: IProduct[]): void;`
	`setPreview(item: IProduct): void;`
	`clearPreview(): void;`
	`setOrder(order: Partial<IOrder>): void;`
	`clearOrder(): void;`
`}`

•	```IProductApi``` Для получения данных о товарах с сервера
•	```IModal``` - Для открытия и закрытия модального окна

#### Классы:

- `AppState` — хранит состояние приложения.
- `Order` - Класс для создания и отправки заказа.

>`createOrder(cartItems: Product[], orderData: TOrderData): Order`: Создает новый заказ, используя информацию из корзины и данные покупателя

- `Cart` - управляет корзиной покупок. Он отвечает за добавление и удаление товаров из корзины, подсчет итоговой стоимости и очистку корзины после оформления заказа.
>`addToCart(product: Product): void`: Добавляет товар в корзину, если его еще нет в корзине.
`events: IEvents`: Объект с событиями
`removeFromCart(productId: string): void`: Удаляет товар из корзины по его ID
`getCartItems(): Product[]`: Возвращает список товаров, находящихся в корзине.
`getTotalPrice(): number`: Возвращает общую стоимость всех товаров в корзине.
`clearCart(): void`: Очищает корзину после успешного оформления заказа.

- `ProductApi` - Класс для получения данных о товарах с сервера
>`fetchProducts(): Product[]`: Загружает список всех товаров с API и возвращает его в виде массива объектов `Product`.

Эти классы отвечают за бизнес-логику приложения, включают в себя функции управления товарами, корзиной, заказами, модальными окнами.

#### View

- `IView` - Интерфейс для рендеринга разметки.
>`render(data: unknown): void`,
`events: IEvents`

- `ShopView` - Класс для рендеринга разметки. View вызывает методы Presenter для обработки действий пользователя и получает обновления от Presenter.
- `Page` — главная страница с каталогом товаров:
>`catalog: IProduct[]`,
`counter: number`,
`locked: boolean`,

- `Modal` - Основной класс для всех модальных окон
>  ```open(): void;```
  ```close(): void;```
  ```setContent(content): void``` - позволяет изменить содержимое модального окна.
  `events: IEvents` - привязывает обработчики событий к модальному окну;

###### Классы Modal:
- `ProductModal` - Класс для отображения информации о товаре в модальном окне. Наследуется от Modal.
`addButton: HTMLElement` - кнопка добавления в корзину
- `BasketModal` - Класс для отображения корзины в модальном окне. Наследуется от Modal.
`basketProducts: HTMLElement` - список товаров в корзине
`totalAmount: HTMLElement` - общая стоимость;
`checkoutButton: HTMLElement` - кнопка оформления заказа
- `OrderModal` - Класс для отображения формы оформления заказа в модальном окне. Наследуется от Modal.
`adressForm: HTMLElement` - форма оформления заказа
`paymentMethods: HTMLElement` - выбор способа оплаты
`nextButton: HTMLElement` - кнопка перехода к следующему шагу
- `ContactsModal` - Класс для отображения формы ввода контактных данных в модальном окне. Наследуется от Modal.
`contactsForm: HTMLElement` - форма ввода контактных данных
`orderButton: HTMLElement` - кнопка подтверждения заказа
- `SuccessModal` - Класс для отображения сообщения об успешном оформлении заказа. Наследуется от Modal.


 `Card` — карточка товара:
>`render(product: IProduct): HTMLElement`

`Basket` — корзина товаров
`OrderForm` — форма оформления заказа

#### Presenter

`shopPresenter`
Связывает данные модели и интерфейса `IView`. Управляет логикой приложения и взаимодействием с пользователем.
Методы:
> `loadProducts(): void` - загружает список товаров.
`openProductModal(product: IProduct): void` - открывает модальное окно с информацией о товаре.
`addToCart(product: IProduct): void` - добавляет товар в корзину.

### Взаимодействие между классами и интерфейсами

#### Главная Страница

При инициализации приложения, ```ShopPresenter``` вызывает методы класса ProductApi для получения списка товаров и передает его в ```ShopView``` для отображения в разметке.

При клике на товар, ```ShopView``` передает данные о выбранном товаре в ```ShopPresenter```. Presenter вызывает метод модального окна ```Modal``` передавая объект модального окна с деталями товара.

#### Добавление товара в корзину
При клике кнопки "В корзину" ```ShopView``` отправляет событие в Presenter.
•	Presenter вызывает метод ```Cart.addToCart()```, передавая выбранный товар.
•	Cart обновляет данные корзины, подсчитывая общую сумму и возвращает информацию об обновленной корзине.
•	Presenter передает обновленные данные корзины в ```ShopView```, чтобы обновить модальное окно.

#### Удаление товара из корзины

В проекте реализованно удаление позиции из корзины. По клику на кнопку корзины, Presenter вызывает метод ```Cart.removeFromCart().``` который удаляет товар из корзины, обновляет данные, и Presenter передает новые данные в ```ShopView```.

#### Оформление заказа

При нажатии на кнопку “Оформить” в корзине, пройдут следующие шаги:
	•	Presenter вызывает ```ShopView``` для открытия модального окна оформления заказа.
	•	Пользователь заполняет поле адреса и выбирает метод оплаты, Presenter проверяет валидность введённого адреса.
	•	Если данные корректны, Presenter вызывает ```ShopView``` для открытия окна заполнения контактных данных.
	•	Пользователь вводит email и телефон, после чего данные валидируются, и заказ создаётся через ```Order.createOrder()```.
	•	```CreateOrder``` возвращает созданный заказ в виде объекта ```IOrder``` и передает его в ```ShopPresenter``` для отправки на сервер.
	•	После успешного создания заказа, корзина очищается через ```Cart.clearCart()```.
	•	В модальном окне выводится сообщение об успешной оплате.



